// ===========================================================================
// US State boundary data — simplified polygons for 48 contiguous + DC
// Coordinates in geographic [longitude, latitude]
// Includes Albers Equal Area projection for canvas rendering
// ===========================================================================

window.US_STATES = (function () {
  'use strict';

  // ── Albers Equal Area Conic projection (standard for US maps) ──
  const RAD = Math.PI / 180;
  const PHI1 = 29.5 * RAD;   // standard parallel 1
  const PHI2 = 45.5 * RAD;   // standard parallel 2
  const PHI0 = 37.5 * RAD;   // center latitude
  const LAM0 = -96 * RAD;    // center longitude

  const n   = (Math.sin(PHI1) + Math.sin(PHI2)) / 2;
  const C   = Math.cos(PHI1) * Math.cos(PHI1) + 2 * n * Math.sin(PHI1);
  const rho0 = Math.sqrt(C - 2 * n * Math.sin(PHI0)) / n;

  // Precomputed normalization bounds for contiguous US
  const BOUNDS = { xMin: Infinity, xMax: -Infinity, yMin: Infinity, yMax: -Infinity };
  function rawProject(lon, lat) {
    var phi = lat * RAD;
    var lam = lon * RAD;
    var rho = Math.sqrt(C - 2 * n * Math.sin(phi)) / n;
    var theta = n * (lam - LAM0);
    return [rho * Math.sin(theta), rho0 - rho * Math.cos(theta)];
  }

  // Calculate bounds from corner points of contiguous US
  [[-124.7, 24.5], [-124.7, 49.4], [-66.9, 24.5], [-66.9, 49.4], [-96, 49.4], [-96, 24.5], [-80, 25], [-67, 45]].forEach(function (p) {
    var xy = rawProject(p[0], p[1]);
    if (xy[0] < BOUNDS.xMin) BOUNDS.xMin = xy[0];
    if (xy[0] > BOUNDS.xMax) BOUNDS.xMax = xy[0];
    if (xy[1] < BOUNDS.yMin) BOUNDS.yMin = xy[1];
    if (xy[1] > BOUNDS.yMax) BOUNDS.yMax = xy[1];
  });

  var PAD = 0.03;
  var xRange = BOUNDS.xMax - BOUNDS.xMin;
  var yRange = BOUNDS.yMax - BOUNDS.yMin;

  function project(lon, lat) {
    var xy = rawProject(lon, lat);
    return [
      PAD + (1 - 2 * PAD) * (xy[0] - BOUNDS.xMin) / xRange,
      PAD + (1 - 2 * PAD) * (BOUNDS.yMax - xy[1]) / yRange
    ];
  }

  // ── State data: id, name, region, center [lon,lat], path [[lon,lat],...] ──
  var states = [
    // ── WEST COAST ──
    { id: 'WA', name: 'Washington', region: 'west', center: [-120.5, 47.5], path: [[-124.7,48.4],[-122.8,48.8],[-120,49],[-117.1,49],[-117.1,46],[-120.5,46.1],[-122.8,46],[-123.5,46.3],[-124.2,47],[-124.7,48.4]] },
    { id: 'OR', name: 'Oregon', region: 'west', center: [-120.5, 44], path: [[-124.5,46.3],[-122.8,46],[-120.5,46.1],[-117.1,46],[-117,44],[-117,42],[-120.5,42],[-124.3,42],[-124.6,43],[-124.5,44.8],[-124.5,46.3]] },
    { id: 'CA', name: 'California', region: 'west', center: [-119.5, 37], path: [[-124.3,42],[-120,42],[-120,39],[-117.6,37.8],[-117.2,36],[-116.1,34.3],[-115.5,33],[-114.6,32.7],[-117.2,32.5],[-118.5,34],[-120.5,34.5],[-121,36.3],[-122,37.5],[-122.5,37.8],[-123,38.5],[-123.8,39.5],[-124.2,40.5],[-124.3,42]] },
    { id: 'NV', name: 'Nevada', region: 'west', center: [-116.8, 39], path: [[-120,42],[-117,42],[-117,41],[-114.1,41],[-114.1,37],[-114.6,36],[-114.8,35.1],[-117.2,36],[-117.6,37.8],[-120,39],[-120,42]] },
    { id: 'ID', name: 'Idaho', region: 'west', center: [-114.5, 44.5], path: [[-117.1,49],[-116.1,49],[-116,47.5],[-115,47],[-114.6,46.6],[-113,45.5],[-112.1,44.5],[-111.1,44.5],[-111.1,42],[-114.1,42],[-114.1,41],[-117,42],[-117,44],[-117.1,46],[-117.1,49]] },
    { id: 'MT', name: 'Montana', region: 'west', center: [-109.5, 47], path: [[-116.1,49],[-111,49],[-108,49],[-104.1,49],[-104.1,45],[-109.5,45],[-111.1,44.5],[-112.1,44.5],[-113,45.5],[-114.6,46.6],[-115,47],[-116,47.5],[-116.1,49]] },
    { id: 'WY', name: 'Wyoming', region: 'west', center: [-107.5, 43], path: [[-111.1,45],[-104.1,45],[-104.1,41],[-111.1,41],[-111.1,44.5],[-111.1,45]] },
    { id: 'UT', name: 'Utah', region: 'west', center: [-111.5, 39.5], path: [[-114.1,42],[-111.1,42],[-111.1,41],[-109.1,41],[-109.1,37],[-112.2,37],[-114.1,37],[-114.1,41],[-114.1,42]] },
    { id: 'CO', name: 'Colorado', region: 'west', center: [-105.5, 39], path: [[-109.1,41],[-102.1,41],[-102.1,37],[-109.1,37],[-109.1,41]] },
    { id: 'AZ', name: 'Arizona', region: 'west', center: [-111.5, 34.3], path: [[-114.8,37],[-109.1,37],[-109.1,31.3],[-111.1,31.3],[-114.8,32.5],[-114.7,34.8],[-114.6,36],[-114.8,37]] },
    { id: 'NM', name: 'New Mexico', region: 'west', center: [-106, 34.5], path: [[-109.1,37],[-103.1,37],[-103.1,32],[-106.6,32],[-109.1,31.3],[-109.1,37]] },

    // ── CENTRAL ──
    { id: 'ND', name: 'North Dakota', region: 'central', center: [-100.5, 47.5], path: [[-104.1,49],[-97,49],[-97,46],[-97,45.9],[-104.1,45.9],[-104.1,49]] },
    { id: 'SD', name: 'South Dakota', region: 'central', center: [-100, 44.5], path: [[-104.1,45.9],[-97,45.9],[-96.5,45.4],[-96.5,43],[-96.5,42.5],[-104.1,43],[-104.1,45],[-104.1,45.9]] },
    { id: 'NE', name: 'Nebraska', region: 'central', center: [-100, 41.5], path: [[-104.1,43],[-96.5,42.5],[-96,42],[-95.4,40],[-96,40],[-102.1,40],[-104.1,41],[-104.1,43]] },
    { id: 'KS', name: 'Kansas', region: 'central', center: [-98.5, 38.5], path: [[-102.1,40],[-94.6,40],[-94.6,37],[-102.1,37],[-102.1,40]] },
    { id: 'OK', name: 'Oklahoma', region: 'central', center: [-97.5, 35.5], path: [[-103.1,37],[-100,37],[-99.5,36.5],[-94.5,36.5],[-94.5,35],[-94.5,33.8],[-96.5,33.8],[-97,33.8],[-97,34.5],[-99.5,34.5],[-100,36.5],[-103.1,36.5],[-103.1,37]] },
    { id: 'TX', name: 'Texas', region: 'central', center: [-99, 31.5], path: [[-103.1,32],[-103.1,36.5],[-100,36.5],[-99.5,34.5],[-97,34.5],[-97,33.8],[-96.5,33.8],[-94.5,33.8],[-94,33.5],[-94,30],[-93.8,29.7],[-95,28.9],[-96.8,28],[-97.2,26],[-97.8,26],[-99,27.5],[-100.5,28.5],[-101,29.8],[-103.1,29],[-104.6,29.5],[-106.6,32],[-103.1,32]] },
    { id: 'MN', name: 'Minnesota', region: 'central', center: [-94.5, 46], path: [[-97,49],[-95.2,49],[-94.5,48.7],[-89.5,48],[-89.6,47.3],[-92.1,46.7],[-92.1,45],[-91.5,43.5],[-91.2,43.5],[-96.5,43.5],[-96.5,45.4],[-97,45.9],[-97,49]] },
    { id: 'IA', name: 'Iowa', region: 'central', center: [-93.5, 42], path: [[-96.5,43.5],[-91.2,43.5],[-91,42.5],[-90.2,41.8],[-90.2,41.5],[-91.1,40.6],[-95.4,40],[-95.8,40.6],[-96,42],[-96.5,42.5],[-96.5,43.5]] },
    { id: 'MO', name: 'Missouri', region: 'central', center: [-92.5, 38.5], path: [[-95.4,40],[-91.1,40.6],[-91.5,40],[-90.2,39.3],[-89.5,38.6],[-89.1,37.5],[-89.5,36.5],[-90.3,35.9],[-94.5,36.5],[-94.6,37],[-94.6,40],[-95.4,40]] },
    { id: 'AR', name: 'Arkansas', region: 'central', center: [-92.5, 34.8], path: [[-94.5,36.5],[-90.3,35.9],[-90.1,35.1],[-90.3,34.7],[-91.1,33.4],[-91.2,33],[-94.5,33],[-94.5,33.8],[-94.5,35],[-94.5,36.5]] },
    { id: 'LA', name: 'Louisiana', region: 'central', center: [-92, 31], path: [[-94,33.5],[-94,33],[-91.2,33],[-91.2,31],[-90,31],[-89.7,30.2],[-89.5,29.3],[-90.8,29],[-92,29.5],[-93.8,29.7],[-94,30],[-94,33.5]] },
    { id: 'WI', name: 'Wisconsin', region: 'central', center: [-89.5, 44.5], path: [[-92.1,46.7],[-89.5,48],[-88.5,47],[-87.5,45.5],[-87.6,43],[-87.8,42.5],[-90.5,42.5],[-91,42.5],[-91.2,43.5],[-91.5,43.5],[-92.1,45],[-92.1,46.7]] },
    { id: 'IL', name: 'Illinois', region: 'central', center: [-89, 40], path: [[-90.5,42.5],[-87.8,42.5],[-87.6,41],[-87.5,39.5],[-87.6,39],[-88.1,37.5],[-89.1,37],[-89.1,37.5],[-89.5,38.6],[-90.2,39.3],[-91.5,40],[-91.1,40.6],[-90.2,41.5],[-90.2,41.8],[-91,42.5],[-90.5,42.5]] },
    { id: 'MI', name: 'Michigan', region: 'central', center: [-85, 44.5], path: [[-86.5,46],[-84.5,45.5],[-83.5,45],[-82.5,43],[-82.4,42],[-83.3,41.7],[-84.8,41.7],[-84.8,42.3],[-86,43],[-86.5,44],[-86.3,45.3],[-87.5,45.5],[-88.5,47],[-89.5,48],[-89.8,46.5],[-88.5,46.5],[-87.6,46],[-86.5,46]] },
    { id: 'IN', name: 'Indiana', region: 'central', center: [-86.3, 40], path: [[-87.6,41.7],[-85,41.7],[-84.8,39.1],[-85,38],[-87.6,37.8],[-87.6,39],[-87.5,39.5],[-87.6,41],[-87.6,41.7]] },
    { id: 'OH', name: 'Ohio', region: 'central', center: [-82.8, 40.3], path: [[-84.8,41.7],[-83.3,41.7],[-82.4,42],[-81,41.5],[-80.5,41],[-80.5,39.7],[-81.7,38.9],[-82.4,38.4],[-83.5,38.5],[-84.8,39.1],[-85,41.7],[-84.8,41.7]] },
    { id: 'MS', name: 'Mississippi', region: 'central', center: [-89.6, 32.7], path: [[-91.2,35],[-88.3,35],[-88.3,31],[-88.5,30.2],[-89,30.2],[-89.5,29.3],[-89.7,30.2],[-90,31],[-91.2,31],[-91.2,33],[-91.1,33.4],[-90.3,34.7],[-90.1,35.1],[-91.2,35]] },
    { id: 'AL', name: 'Alabama', region: 'central', center: [-86.8, 33], path: [[-88.3,35],[-85,35],[-85,32.2],[-85,31],[-87.6,30.3],[-88.3,30.2],[-88.5,30.2],[-88.3,31],[-88.3,35]] },
    { id: 'TN', name: 'Tennessee', region: 'central', center: [-86, 35.8], path: [[-90.3,35.9],[-89.5,36.5],[-82,36.6],[-81.7,36.3],[-82,35.2],[-84,35],[-84.7,35],[-85,35],[-88.3,35],[-90.1,35.1],[-90.3,35.9]] },
    { id: 'KY', name: 'Kentucky', region: 'central', center: [-85.5, 37.8], path: [[-89.5,36.5],[-89.1,37.5],[-88.1,37.5],[-87.6,37.8],[-85,38],[-84.8,39.1],[-83.5,38.5],[-82.6,38.2],[-82,37],[-82,36.6],[-89.5,36.5]] },

    // ── EAST COAST ──
    { id: 'ME', name: 'Maine', region: 'east', center: [-69, 45.5], path: [[-71.1,45.3],[-70,43.4],[-69,44],[-67.1,44.5],[-67,45],[-67.4,47.4],[-69.1,47.4],[-71.1,45.3]] },
    { id: 'VT', name: 'Vermont', region: 'east', center: [-72.6, 44], path: [[-73.3,45],[-72,45],[-71.5,44],[-72.5,42.7],[-73.3,43],[-73.3,44],[-73.3,45]] },
    { id: 'NH', name: 'New Hampshire', region: 'east', center: [-71.5, 44], path: [[-72,45],[-71.1,45.3],[-71,43],[-70.8,42.7],[-71.5,42.7],[-72.5,42.7],[-71.5,44],[-72,45]] },
    { id: 'MA', name: 'Massachusetts', region: 'east', center: [-71.5, 42.2], path: [[-73.3,42.7],[-71.8,42.7],[-71.5,42.7],[-70.8,42.7],[-70,41.7],[-70,42],[-69.9,41.7],[-71,41.5],[-71.4,42],[-73.3,42.1],[-73.3,42.7]] },
    { id: 'CT', name: 'Connecticut', region: 'east', center: [-72.7, 41.6], path: [[-73.7,41.1],[-73.7,42.1],[-71.8,42.1],[-71.8,41.2],[-72,41],[-73.7,41.1]] },
    { id: 'RI', name: 'Rhode Island', region: 'east', center: [-71.5, 41.7], path: [[-71.8,42.1],[-71.1,42.1],[-71.1,41.2],[-71.8,41.2],[-71.8,42.1]] },
    { id: 'NY', name: 'New York', region: 'east', center: [-75.5, 43], path: [[-79.8,42.5],[-75.1,42],[-73.3,42.1],[-73.3,43],[-73.3,45],[-74.5,45],[-75.3,45],[-76.3,44],[-76.5,43.3],[-79.1,43.3],[-79.8,42.5]] },
    { id: 'NJ', name: 'New Jersey', region: 'east', center: [-74.5, 40.2], path: [[-75.6,41.4],[-74,41.4],[-73.9,40.5],[-74,39.6],[-74.9,38.9],[-75.6,39.5],[-75.2,40],[-75.6,41.4]] },
    { id: 'PA', name: 'Pennsylvania', region: 'east', center: [-77.5, 41], path: [[-80.5,42.3],[-79.8,42.5],[-75.1,42],[-75,41.4],[-75.6,41.4],[-75.2,40],[-75.6,39.7],[-80.5,39.7],[-80.5,41],[-80.5,42.3]] },
    { id: 'DE', name: 'Delaware', region: 'east', center: [-75.5, 39], path: [[-75.8,39.8],[-75.4,39.8],[-75,38.5],[-75.6,38.5],[-75.8,39.2],[-75.8,39.8]] },
    { id: 'MD', name: 'Maryland', region: 'east', center: [-76.6, 39], path: [[-79.5,39.3],[-77.5,39.7],[-76,38.4],[-75.4,39.8],[-75.8,39.8],[-76.2,39.3],[-76.5,39.5],[-77.4,39.3],[-79.5,39.7],[-79.5,39.3]] },
    { id: 'DC', name: 'District of Columbia', region: 'east', center: [-77, 38.9], path: [[-77.1,39],[-77.1,38.8],[-76.9,38.8],[-76.9,39],[-77.1,39]] },
    { id: 'VA', name: 'Virginia', region: 'east', center: [-78.5, 37.5], path: [[-83.5,36.6],[-79.5,36.6],[-77.5,36.6],[-75.6,36.7],[-75.5,37.5],[-76.2,37.2],[-76.5,38],[-77,38.3],[-77.4,39.3],[-79.5,39.3],[-80,38.5],[-80.5,38],[-81.7,37.3],[-82,36.6],[-83.5,36.6]] },
    { id: 'WV', name: 'West Virginia', region: 'east', center: [-80.5, 38.6], path: [[-82.6,38.2],[-81.7,38.9],[-80.5,39.7],[-80.5,41],[-80.5,39.7],[-79.5,39.7],[-79.5,39.3],[-80,38.5],[-80.5,38],[-81.7,37.3],[-82,37],[-82.6,38.2]] },
    { id: 'NC', name: 'North Carolina', region: 'east', center: [-79.5, 35.5], path: [[-84,35],[-82,35.2],[-81.7,36.3],[-82,36.6],[-75.5,36.5],[-75.5,35.3],[-76.5,34.5],[-78,33.9],[-79.5,34.5],[-81,34.3],[-84,35]] },
    { id: 'SC', name: 'South Carolina', region: 'east', center: [-80.5, 34], path: [[-83.3,35],[-82,35],[-81,34.3],[-79.5,34.5],[-78,33.9],[-79.3,33],[-80.4,32.5],[-81.1,32.1],[-81.8,32.3],[-83.3,34.5],[-83.3,35]] },
    { id: 'GA', name: 'Georgia', region: 'east', center: [-83.5, 33], path: [[-85,35],[-84,35],[-83.3,35],[-83.3,34.5],[-81.8,32.3],[-81.1,31.2],[-81.5,30.7],[-82.1,30.6],[-84.9,30.6],[-85,31],[-85,32.2],[-85,35]] },
    { id: 'FL', name: 'Florida', region: 'east', center: [-82, 28.5], path: [[-87.6,31],[-85,31],[-84.9,30.6],[-82.1,30.6],[-81.5,30.7],[-81.2,29.5],[-80.5,28],[-80,26.5],[-80.5,25.2],[-81.5,25],[-81.9,26.5],[-82.5,27.5],[-82.6,29],[-84,30],[-85.4,29.8],[-86.5,30.4],[-87.6,30.3],[-87.6,31]] },
  ];

  // ── Population-weighted activity scores (for mock data) ──
  var population = {
    CA: 39.5, TX: 29.5, FL: 22, NY: 20, PA: 13, IL: 12.7, OH: 11.8,
    GA: 10.8, NC: 10.5, MI: 10, NJ: 9.3, VA: 8.6, WA: 7.7, AZ: 7.3,
    MA: 7, TN: 7, IN: 6.8, MO: 6.2, MD: 6.2, WI: 5.9, CO: 5.8,
    MN: 5.7, SC: 5.2, AL: 5, LA: 4.7, KY: 4.5, OR: 4.2, OK: 4,
    CT: 3.6, UT: 3.3, IA: 3.2, NV: 3.1, AR: 3, MS: 3, KS: 2.9,
    NM: 2.1, NE: 2, ID: 1.9, WV: 1.8, ME: 1.4, NH: 1.4, MT: 1.1,
    RI: 1.1, DE: 1, SD: 0.9, ND: 0.8, VT: 0.6, WY: 0.6, DC: 0.7
  };

  // ── Regional groupings ──
  var regions = {
    west:    { label: 'West Coast', states: ['WA','OR','CA','NV','ID','MT','WY','UT','CO','AZ','NM'] },
    central: { label: 'Central', states: ['ND','SD','NE','KS','OK','TX','MN','IA','MO','AR','LA','WI','IL','MI','IN','OH','MS','AL','TN','KY'] },
    east:    { label: 'East Coast', states: ['ME','VT','NH','MA','CT','RI','NY','NJ','PA','DE','MD','DC','VA','WV','NC','SC','GA','FL'] },
  };

  // ── Top 10 metro areas for map markers ──
  var metros = [
    { id: 'NYC', name: 'New York',      lon: -74.0,  lat: 40.7 },
    { id: 'LA',  name: 'Los Angeles',   lon: -118.2, lat: 34.1 },
    { id: 'CHI', name: 'Chicago',       lon: -87.6,  lat: 41.9 },
    { id: 'HOU', name: 'Houston',       lon: -95.4,  lat: 29.8 },
    { id: 'PHX', name: 'Phoenix',       lon: -112.1, lat: 33.4 },
    { id: 'PHL', name: 'Philadelphia',  lon: -75.2,  lat: 40.0 },
    { id: 'SA',  name: 'San Antonio',   lon: -98.5,  lat: 29.4 },
    { id: 'SD',  name: 'San Diego',     lon: -117.2, lat: 32.7 },
    { id: 'DAL', name: 'Dallas',        lon: -96.8,  lat: 32.8 },
    { id: 'AUS', name: 'Austin',        lon: -97.7,  lat: 30.3 },
  ];

  return {
    project: project,
    states: states,
    population: population,
    regions: regions,
    metros: metros,
  };
})();
